# RemoteApp 功能测试指南

## 前置条件

### 服务器端配置
1. Windows Server 2008 R2 或更高版本
2. 已安装并配置远程桌面服务 (RDS)
3. 已启用 RemoteApp 功能
4. 用户账户具有远程登录权限

### 客户端要求
1. Windows 操作系统
2. 已安装 RDP ActiveX 控件
3. 网络可以访问远程服务器

## 测试用例

### 测试 1: 启动记事本（基本功能）

**目的**: 验证 RemoteApp 基本启动功能

**步骤**:
1. 启动 RDC 客户端
2. 点击 [连接] -> [启动应用]
3. 填写配置：
   - 计算机: `<服务器IP>`
   - 端口: `3389`
   - 用户名: `<用户名>`
   - 可执行文件路径: `C:\Windows\System32\notepad.exe`
4. 点击 OK
5. 输入密码（如需要）

**预期结果**:
- 连接成功
- 记事本窗口出现
- 状态栏显示 "RemoteApp 已启动: C:\Windows\System32\notepad.exe"

---

### 测试 2: 启动记事本并打开文件

**目的**: 验证文件路径参数功能

**前置**: 在远程服务器上创建测试文件 `C:\test.txt`

**步骤**:
1. 启动 RDC 客户端
2. 点击 [连接] -> [启动应用]
3. 填写配置：
   - 计算机: `<服务器IP>`
   - 端口: `3389`
   - 用户名: `<用户名>`
   - 可执行文件路径: `C:\Windows\System32\notepad.exe`
   - 文件路径: `C:\test.txt`
4. 点击 OK

**预期结果**:
- 记事本启动并自动打开 test.txt 文件
- 文件内容正确显示

---

### 测试 3: 使用工作目录

**目的**: 验证工作目录参数功能

**步骤**:
1. 启动 RDC 客户端
2. 点击 [连接] -> [启动应用]
3. 填写配置：
   - 计算机: `<服务器IP>`
   - 用户名: `<用户名>`
   - 可执行文件路径: `C:\Windows\System32\cmd.exe`
   - 工作目录: `C:\Windows\System32`
   - 命令行参数: `/k cd`
4. 点击 OK

**预期结果**:
- CMD 窗口启动
- 当前目录显示为 `C:\Windows\System32`

---

### 测试 4: 使用环境变量

**目的**: 验证环境变量展开功能

**步骤**:
1. 启动 RDC 客户端
2. 点击 [连接] -> [启动应用]
3. 填写配置：
   - 计算机: `<服务器IP>`
   - 用户名: `<用户名>`
   - 可执行文件路径: `C:\Windows\System32\notepad.exe`
   - 工作目录: `%USERPROFILE%\Documents`
   - 勾选 "在服务器上展开环境变量"（工作目录）
4. 点击 OK

**预期结果**:
- 记事本启动
- 工作目录被正确展开为用户的 Documents 文件夹

---

### 测试 5: 使用命令行参数

**目的**: 验证命令行参数功能

**步骤**:
1. 启动 RDC 客户端
2. 点击 [连接] -> [启动应用]
3. 填写配置：
   - 计算机: `<服务器IP>`
   - 用户名: `<用户名>`
   - 可执行文件路径: `C:\Windows\System32\cmd.exe`
   - 命令行参数: `/k echo Hello RemoteApp`
4. 点击 OK

**预期结果**:
- CMD 窗口启动
- 显示 "Hello RemoteApp"

---

### 测试 6: 启动 Office 应用

**目的**: 验证复杂应用程序支持

**前置**: 远程服务器已安装 Microsoft Office

**步骤**:
1. 启动 RDC 客户端
2. 点击 [连接] -> [启动应用]
3. 填写配置：
   - 计算机: `<服务器IP>`
   - 用户名: `<用户名>`
   - 可执行文件路径: `C:\Program Files\Microsoft Office\root\Office16\WINWORD.EXE`
   - 文件路径: `C:\Users\Public\Documents\test.docx`（如果文件存在）
4. 点击 OK

**预期结果**:
- Word 启动
- 如果指定了文件，文件被打开

---

### 测试 7: 错误处理 - 无效的可执行文件路径

**目的**: 验证错误处理机制

**步骤**:
1. 启动 RDC 客户端
2. 点击 [连接] -> [启动应用]
3. 填写配置：
   - 计算机: `<服务器IP>`
   - 用户名: `<用户名>`
   - 可执行文件路径: `C:\NonExistent\app.exe`
4. 点击 OK

**预期结果**:
- 连接建立
- 显示错误信息（应用启动失败）
- 不会导致程序崩溃

---

### 测试 8: 错误处理 - 空的可执行文件路径

**目的**: 验证输入验证

**步骤**:
1. 启动 RDC 客户端
2. 点击 [连接] -> [启动应用]
3. 填写配置：
   - 计算机: `<服务器IP>`
   - 用户名: `<用户名>`
   - 可执行文件路径: （留空）
4. 点击 OK

**预期结果**:
- 连接建立
- 显示错误信息 "可执行文件路径不能为空"

---

### 测试 9: 与远程桌面模式对比

**目的**: 验证两种模式的区别

**步骤**:
1. 先使用 [连接] -> [启动] 启动远程桌面
2. 观察显示效果
3. 断开连接
4. 使用 [连接] -> [启动应用] 启动记事本
5. 观察显示效果

**预期结果**:
- 远程桌面模式: 显示完整的远程桌面
- RemoteApp 模式: 只显示记事本窗口，无远程桌面背景

---

### 测试 10: 多参数组合

**目的**: 验证所有参数同时使用

**步骤**:
1. 启动 RDC 客户端
2. 点击 [连接] -> [启动应用]
3. 填写所有配置：
   - 计算机: `<服务器IP>`
   - 用户名: `<用户名>`
   - 可执行文件路径: `C:\Windows\System32\cmd.exe`
   - 文件路径: （留空）
   - 工作目录: `%TEMP%`
   - 勾选 "在服务器上展开环境变量"（工作目录）
   - 命令行参数: `/k dir`
   - 勾选 "在服务器上展开环境变量"（参数）
4. 点击 OK

**预期结果**:
- CMD 启动
- 工作目录为临时文件夹
- 显示目录列表

---

## 调试技巧

### 查看日志输出

在开发环境中运行时，可以查看控制台输出：

```
RDP Login completed
Starting RemoteApp after login...
Starting RemoteApp:
  Executable: C:\Windows\System32\notepad.exe
  File: 
  WorkDir: 
  Arguments: 
RemoteApp started successfully
```

### 常见问题排查

**问题 1: 连接成功但应用未启动**
- 检查: 可执行文件路径是否正确
- 检查: 服务器是否支持 RemoteApp
- 检查: 用户是否有执行权限

**问题 2: 显示 "RemoteProgram接口不可用"**
- 检查: RDP ActiveX 控件版本
- 检查: 服务器 RDS 配置
- 尝试: 使用远程桌面模式验证基本连接

**问题 3: 环境变量未展开**
- 检查: 是否勾选了"在服务器上展开环境变量"
- 检查: 环境变量语法是否正确（使用 `%VAR%` 格式）

**问题 4: 应用启动后立即关闭**
- 检查: 应用程序是否需要特定参数
- 检查: 工作目录是否正确
- 检查: 应用程序日志

## 性能测试

### 启动时间测试

记录从点击 OK 到应用窗口显示的时间：

| 应用程序 | 预期时间 | 实际时间 | 备注 |
|---------|---------|---------|------|
| 记事本 | < 3秒 | | |
| CMD | < 2秒 | | |
| Word | < 10秒 | | 取决于 Office 版本 |
| Excel | < 10秒 | | 取决于 Office 版本 |

### 网络延迟测试

在不同网络条件下测试：

- 局域网 (< 1ms)
- 广域网 (10-50ms)
- 高延迟网络 (> 100ms)

## 测试报告模板

```
测试日期: ____________________
测试人员: ____________________
RDC 版本: ____________________
服务器系统: __________________

测试用例编号: ________________
测试结果: □ 通过  □ 失败
实际结果: ____________________
问题描述: ____________________
截图: ________________________
```

## 自动化测试建议

未来可以考虑实现自动化测试：

1. 使用 Qt Test 框架
2. 模拟用户输入
3. 验证连接状态
4. 检查窗口创建
5. 自动截图对比

## 回归测试清单

每次修改后应执行的最小测试集：

- [ ] 测试 1: 启动记事本
- [ ] 测试 2: 启动记事本并打开文件
- [ ] 测试 7: 错误处理 - 无效路径
- [ ] 测试 9: 与远程桌面模式对比

## 总结

完成所有测试用例后，应该能够确认：

1. ✓ RemoteApp 基本功能正常
2. ✓ 所有参数正确传递
3. ✓ 环境变量展开功能正常
4. ✓ 错误处理机制完善
5. ✓ 与远程桌面模式区分明确
